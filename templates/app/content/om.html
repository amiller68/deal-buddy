<div class="container mx-auto px-4 py-8">
    <div class="flex items-center mb-6">
        <!-- set the href to the dashboard -->
        <a href="/app" class="text-blue-500 hover:text-blue-600 mr-4 htmx-link">
            ‚Üê Back to Dashboard
        </a>
        <h1 class="text-3xl font-bold">OM Details</h1>
    </div>

    <div class="bg-white shadow-md rounded px-8 pt-6 pb-8">
        <div id="om-status" 
             hx-get="/api/v0/oms/{{ id }}" 
             hx-trigger="load, every 2s until [data-status='processed']"
             data-status="{{ status }}"
             hx-on::after-swap="this.setAttribute('data-status', this.querySelector('.status-value').textContent.trim())">
            <div class="space-y-4">
                <!-- Status indicator -->
                <div class="flex items-center">
                    <div class="mr-3">
                        <div class="spinner"></div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold">Status: <span class="status-value text-blue-500">{{ status }}</span></h3>
                        <p class="text-gray-600">
                            {% if status == "uploaded" %}
                                Waiting to begin processing...
                            {% elif status == "processing" %}
                                Processing your OM. This may take a few minutes...
                            {% elif status == "processed" %}
                                Processing complete!
                            {% elif status == "failed" %}
                                Processing failed. Please try uploading again.
                            {% endif %}
                        </p>
                    </div>
                </div>

                {% if status == "processed" %}
                <div class="space-y-4">
                    {% if title %}
                    <div class="mb-4">
                        <h4 class="font-semibold text-gray-700">Title</h4>
                        <p class="text-gray-900">{{ title }}</p>
                    </div>
                    {% endif %}

                    {% if description %}
                    <div class="mb-4">
                        <h4 class="font-semibold text-gray-700">Description</h4>
                        <p class="text-gray-900">{{ description }}</p>
                    </div>
                    {% endif %}

                    {% if summary %}
                    <div>
                        <h4 class="font-semibold text-gray-700">Summary</h4>
                        <div class="bg-gray-50 p-4 rounded mt-2">
                            <p class="text-gray-900 whitespace-pre-wrap">{{ summary }}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% elif status == "failed" %}
                <div class="bg-red-50 border-l-4 border-red-400 p-4 mt-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-red-700">
                                Processing failed. Please try uploading your OM again.
                            </p>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
    .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>